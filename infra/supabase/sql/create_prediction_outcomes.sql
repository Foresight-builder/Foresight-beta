-- 创建预测事件选项表
CREATE TABLE IF NOT EXISTS public.prediction_outcomes (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  prediction_id BIGINT NOT NULL REFERENCES public.predictions(id) ON DELETE CASCADE,
  outcome_index INTEGER NOT NULL,
  label TEXT NOT NULL,
  description TEXT,
  color TEXT,
  image_url TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  UNIQUE(prediction_id, outcome_index)
);

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_prediction_outcomes_prediction_id ON public.prediction_outcomes(prediction_id);

-- 启用 RLS
ALTER TABLE public.prediction_outcomes ENABLE ROW LEVEL SECURITY;

-- 允许所有用户读取
CREATE POLICY "prediction_outcomes_select_all" ON public.prediction_outcomes FOR SELECT USING (true);

-- 允许服务角色或管理员插入（这里简化为允许所有已认证用户插入，但在 API 层需做校验）
-- 实际生产环境应更严格，建议仅允许 service_role 或 admin
CREATE POLICY "prediction_outcomes_insert_authenticated" ON public.prediction_outcomes FOR INSERT TO authenticated WITH CHECK (true);
CREATE POLICY "prediction_outcomes_update_authenticated" ON public.prediction_outcomes FOR UPDATE TO authenticated USING (true);
CREATE POLICY "prediction_outcomes_delete_authenticated" ON public.prediction_outcomes FOR DELETE TO authenticated USING (true);
